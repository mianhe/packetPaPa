*** Settings ***
Resource          common_ressouce.txt
Library           ../../src/packetPaPa.py

*** Test Cases ***
parse DHCP
    parse packet from bit stream    packet definition    \\h010106006c5767a700000000c0a800670000000000000000000000006431505580af00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000638253633501033d07016431505580af0c0b4356303030343631314e3051210000004356303030343631314e302e6164342e61642e616c636174656c2e636f6d3c084d53465420352e30370c010f03062c2e2f1f2179792bff0000
    ${struct}    Show Packet
    log    ${struct}

build DHCP
    open log
    start packet
    dhcp head
    add option    6    www.sina.com
    add option    9    1234
    Byte Stream    pad    3    \\hff0000
    ${stream}    pack packet
    parse packet from bit stream    packet definition    ${stream}
    ${struct}    show packet
    log    ${struct}

*** Keywords ***
packet definition
    [Documentation]    0 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 3
    ...    \ 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    ...    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ...    | \ \ \ \ op (1) \ \ \ | \ \ htype (1) \ \ | \ \ hlen (1) \ \ \ | \ \ hops (1) \ \ \ |
    ...    +---------------+---------------+---------------+---------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xid (4) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +-------------------------------+-------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ secs (2) \ \ \ \ \ \ \ \ \ \ \ | \ \ \ \ \ \ \ \ \ \ flags (2) \ \ \ \ \ \ \ \ \ \ |
    ...    +-------------------------------+-------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ciaddr \ (4) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ yiaddr \ (4) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ siaddr \ (4) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ giaddr \ (4) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chaddr \ (16) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sname \ \ (64) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file \ \ \ (128) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    | \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ options (variable) \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |
    ...    +---------------------------------------------------------------+
    start packet
    dhcp head
    head end
    tlv group    option    1    1

dhcp head
    u8    op    1
    u8    htype    1
    u8    hlen    1
    u8    hops    1
    u32    xid
    u16    secs    6
    u16    flags    0
    ip    ciaddr
    ip    yiaddr
    ip    siaddr
    ip    giaddr
    mac    chaddr
    byte stream    mac padding    10
    byte stream    sname    64
    byte stream    file    128
    u32    magic cookie    0x89abcdef

add option
    [Arguments]    ${type}    ${value}
    tlv    option[${type}]    1    1    0    ${type}    ${value}
